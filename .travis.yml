language: "perl"

perl:
  - "5.14"
os:
  - linux
dist:
  - xenial

sudo: true

addons:
  apt:
    packages:
    - git
    - libtry-tiny-perl
    - perl-tk
    - libproc-processtable-perl
    - libdbi-perl
    - libreadonly-perl
    - liblog-log4perl-perl
    - libterm-readkey-perl
    - libxml-simple-perl
    - libtext-sprintfn-perl
    - libjson-perl
    - libconfig-inifiles-perl
    - liblingua-en-inflect-perl
    - libio-stringy-perl
    - libdata-rmap-perl
    - libnamespace-autoclean-perl
    - libyaml-perl
    - libhash-merge-simple-perl
    - libfile-slurp-perl
    - libmoosex-role-strict-perl
    - libmoosex-log-log4perl-perl
    - liblog-any-adapter-screencoloredlevel-perl
    - cpanminus
    - libzeromq-perl
    - libzmqpp-dev
    - libanyevent-perl
    - libconst-fast-perl
    - libtest-mockobject-perl
    - libapache2-mod-perl2
    - mysql-client apache2
    - sqlite3
    - libcurl3
    - libcurl4-openssl-dev
    - libsqlite3-dev
    - libgtk2.0-dev
    - libmysqlclient-dev
    - libconfig-dev
    - libhts-dev
    - libreadline6-dev
    - libssl-dev
    - libgnutls-dev
    - exonerate
    - hmmer2
    - libdbd-sqlite3-perl
    - libdbd-mysql-perl
    - uuid-dev
    - libbz2-dev
    - liblzma-dev

before_install:
    - git clone --branch master --depth 1 https://github.com/Ensembl/team_tools.git
    - git clone --branch master --depth 1 https://github.com/Ensembl/webvm.git
    - git clone --branch master --depth 1 https://github.com/Ensembl/webvm-deps.git
    - travis_wait sudo cpanm Try::Tiny Test::Class::Most Tk Proc::ProcessTable DBI Readonly Log::Log4perl Term::ReadKey XML::Simple Text::sprintfn JSON Config::IniFiles Lingua::EN::Inflect IO::Scalar Data::Rmap namespace::autoclean YAML Hash::Merge::Simple File::Slurp Moose::Role MooseX::Log::Log4perl Log::Log4perl::Appender XML::Entities Const::Fast Crypt::CBC App::Cmd::Simple Mac::PropertyList Bio::DB::HTS XML::Entities ZMQ::LibZMQ3 Crypt::CBC App::Cmd::Simple Mac::PropertyList
    - git clone git://genome-source.soe.ucsc.edu/kent.git
    - cd kent
    - export KENT_SRC=$PWD
    - sed -i -- 's/-DUCSC_CRAM/-DUCSC_CRAM -fPIC/g' ./src/htslib/Makefile
    - sed -i -- 's/CC=gcc/CC=gcc -fPIC/g' ./src/inc/common.mk
    - cd src

install:
    - cpanm DBD::SQLite
    - mysql -u root -h localhost -e 'GRANT ALL PRIVILEGES ON *.* TO "travis"@"%"'

script: "./travisci.sh"
